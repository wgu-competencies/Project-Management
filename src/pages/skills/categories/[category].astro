---
import StarlightPage from '@astrojs/starlight/components/StarlightPage.astro';
import fs from 'node:fs';
import path from 'node:path';
import { fileURLToPath } from 'node:url';

export async function getStaticPaths() {
  const __filename = fileURLToPath(import.meta.url);
  const __dirname = path.dirname(__filename);
  const projectRoot = path.resolve(__dirname, '../../../..');
  const collectionPath = path.join(projectRoot, 'skills-collection.json');
  const collectionData = JSON.parse(fs.readFileSync(collectionPath, 'utf-8'));
  
  // Get all unique categories
  const categoriesMap = new Map();
  
  collectionData.skills.forEach((skill) => {
    if (skill.categories) {
      skill.categories.forEach((category) => {
        if (!categoriesMap.has(category)) {
          categoriesMap.set(category, []);
        }
        categoriesMap.get(category).push(skill);
      });
    }
  });
  
  // Create a path for each category
  return Array.from(categoriesMap.entries()).map(([category, skills]) => ({
    params: { category: category },
    props: { 
      category,
      skills: skills.sort((a, b) => a.name.localeCompare(b.name))
    },
  }));
}

const { category, skills } = Astro.props;
---

<StarlightPage
  frontmatter={{
    title: category,
    description: `Skills in the ${category} category`,
    tableOfContents: false,
  }}
>
  <div class="category-page">
    <div class="category-header">
      <p class="breadcrumb">
        <a href="/Project-Management/skills">All Skills</a> / {category}
      </p>
      <p class="skill-count">{skills.length} {skills.length === 1 ? 'skill' : 'skills'}</p>
    </div>

    <div class="skills-list">
      {skills.map((skill) => (
        <div class="skill-card">
          <a href={`/Project-Management/skills/${skill.uuid}`}>
            <h3>{skill.name}</h3>
            <p class="skill-statement">{skill.skillStatement}</p>
            {skill.categories && skill.categories.length > 1 && (
              <div class="skill-other-categories">
                {skill.categories
                  .filter(cat => cat !== category)
                  .map((cat) => (
                    <span class="category-tag">{cat}</span>
                  ))}
              </div>
            )}
          </a>
        </div>
      ))}
    </div>
  </div>

  <style>
    .category-page {
      max-width: 1000px;
      margin: 0 auto;
    }

    .category-header {
      margin-bottom: 2rem;
      padding-bottom: 1.5rem;
      border-bottom: 2px solid var(--sl-color-gray-5);
    }

    .breadcrumb {
      font-size: 0.9rem;
      color: var(--sl-color-gray-3);
      margin-bottom: 0.5rem;
    }

    .breadcrumb a {
      color: var(--sl-color-accent);
      text-decoration: none;
    }

    .breadcrumb a:hover {
      text-decoration: underline;
    }

    .skill-count {
      font-weight: 600;
      color: var(--sl-color-gray-2);
      font-size: 1.1rem;
    }

    .skills-list {
      display: grid;
      gap: 1rem;
    }

    .skill-card {
      border: 1px solid var(--sl-color-gray-5);
      border-radius: 8px;
      padding: 1.5rem;
      transition: all 0.2s;
      background: var(--sl-color-bg-nav);
    }

    .skill-card:hover {
      border-color: var(--sl-color-accent);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .skill-card a {
      text-decoration: none;
      color: inherit;
      display: block;
    }

    .skill-card h3 {
      margin: 0 0 0.75rem 0;
      color: var(--sl-color-accent);
      font-size: 1.2rem;
    }

    .skill-statement {
      color: var(--sl-color-gray-2);
      line-height: 1.6;
      margin-bottom: 0.75rem;
    }

    .skill-other-categories {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 0.75rem;
    }

    .category-tag {
      font-size: 0.85rem;
      padding: 0.25rem 0.75rem;
      background: var(--sl-color-gray-6);
      color: var(--sl-color-gray-2);
      border-radius: 4px;
    }
  </style>
</StarlightPage>
